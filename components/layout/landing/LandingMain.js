"use client";

import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import { useRef } from "react";
import anime from "animejs";
import { Button } from "@material-tailwind/react";
import { ChevronRight } from "lucide-react";
import { useRouter } from "next/navigation";
import FloatingItem from "./FloatingItem";
import items from "./Items";
import GridPaths from "./GridPaths";

export default function LandingMain() {
  const gallery = useRef(null);
  const router = useRouter();

  useGSAP(() => {
    gsap.to(gallery.current, {
      opacity: 1,
      duration: 10,
    });

    let ctx = gsap.context(() => {
      window.onmousemove = (e) => {
        const mouseX = e.clientX;
        const mouseY = e.clientY;

        const ratioX = mouseX / window.innerWidth;
        const ratioY = mouseY / window.innerHeight;

        const maxPanX = gallery.current?.offsetWidth - window.innerWidth;
        const maxPanY = gallery.current?.offsetHeight - window.innerHeight;

        const panX = ratioX * maxPanX * -1;
        const panY = ratioY * maxPanY * -1;

        gsap.to(gallery.current, {
          x: panX,
          y: panY,
          duration: 1.5,
        });
      };
    }, gallery);

    return () => ctx.revert();
  }, [gallery]);

  useGSAP(() => {
    const path = document.getElementById("grid").querySelectorAll("path");
    for (let i = 0; i < path?.length; i++) {
      let pathEl = path[i];
      let offset = anime.setDashoffset(pathEl);
      pathEl.setAttribute("stroke-dashoffset", offset);

      anime({
        targets: pathEl,
        strokeDashoffset: [offset, 0],
        duration: anime.random(5000, 15000),
        delay: anime.random(0, 2000),
        loop: true,
        direction: "alternate",
        easing: "easeInOutSine",
        autoplay: true,
      });
    }

    anime({
      targets: ["#logo-svg path"],
      strokeDashoffset: [anime.setDashoffset, 0],
      easing: "easeInOutSine",
      duration: 20000,
      delay: function (el, i) {
        return i * 250;
      },
      direction: "alternate",
      loop: true,
    });

    anime({
      targets: ["#logo-svg path"],
      fill: ["#ffffff00", "#000000"],
      easing: "easeInOutSine",
      duration: 5000,
      delay: function (el, i) {
        return i * 250;
      },
      direction: "alternate",
      loop: true,
    });
  }, []);

  return (
    <div className="h-[100vh] w-[100vw] relative overflow-hidden">
      <div className="h-[100vh] w-[100vw] fixed overflow-hidden flex items-center justify-center">
        <div className="w-96 h-96 flex items-center justify-center">
          <svg
            id="logo-svg"
            preserveAspectRatio="xMidYMid meet"
            viewBox="-100 -175 1000 550"
          >
            <path
              stroke="black"
              strokeWidth="1"
              fill="none"
              d="M85.825,62.932C81.396,59.794 75.828,58.225 69.122,58.225C60.693,58.225 53.572,63.516 47.758,74.098C41.944,84.68 39.037,97.692 39.037,113.135C39.037,121.133 41.405,125.132 46.143,125.132C51.557,125.132 58.17,120.948 65.984,112.581C76.812,100.953 83.026,87.787 84.625,73.083L85.825,62.932ZM101.606,51.488C101.298,52.596 101.114,53.272 101.052,53.519L100.037,58.41C99.237,61.978 98.807,63.947 98.745,64.316L95.054,98.092C94.438,103.752 93.792,113.688 93.116,127.9C92.254,145.681 90.563,158.847 88.04,167.398C85.518,175.95 81.057,183.579 74.659,190.285C60.016,205.727 44.42,213.449 27.87,213.449C19.872,213.449 13.228,210.742 7.937,205.328C2.646,199.914 0,193.146 0,185.025C0,168.475 10.121,152.141 30.362,136.021C26.055,132.638 23.902,126.67 23.902,118.118C23.902,99.538 30.023,83.388 42.267,69.668C54.51,55.949 68.968,49.089 85.641,49.089C92.716,49.089 98.038,49.889 101.606,51.488ZM81.672,99.938C65.061,125.286 50.019,137.959 36.545,137.959C35.991,137.959 35.007,137.898 33.592,137.775C19.318,152.171 12.182,164.999 12.182,176.258C12.182,183.948 14.904,190.393 20.349,195.592C25.794,200.79 32.546,203.39 40.605,203.39C53.033,203.39 62.569,197.914 69.214,186.963C74.259,178.534 77.766,158.447 79.734,126.701C80.473,114.704 81.119,105.783 81.672,99.938ZM169.159,106.859C170.697,107.905 171.466,109.136 171.466,110.551C171.466,112.458 169.497,115.719 165.56,120.333C155.039,132.515 144.642,138.605 134.367,138.605C128.092,138.605 122.924,136.114 118.863,131.13C114.803,126.147 112.772,119.779 112.772,112.027C112.772,98 118.079,83.803 128.692,69.438C139.304,55.072 149.81,47.889 160.207,47.889C167.713,47.889 171.466,51.919 171.466,59.978C171.466,69.022 167.082,77.851 158.315,86.464C149.548,95.078 138.858,101.076 126.246,104.46C127.477,119.287 133.321,126.701 143.78,126.701C154.116,126.701 162.576,120.087 169.159,106.859ZM126.615,93.201C128.399,93.816 130.03,94.124 131.506,94.124C139.135,94.124 145.811,91.786 151.532,87.11C157.254,82.435 160.115,76.959 160.115,70.684C160.115,63.485 156.454,59.886 149.133,59.886C143.842,59.886 139.058,63.039 134.782,69.345C130.507,75.652 127.784,83.603 126.615,93.201ZM212.256,60.994L207.642,101.784C206.842,109.105 206.442,114.519 206.442,118.026C206.442,124.978 208.811,128.454 213.548,128.454C218.654,128.454 223.945,124.27 229.421,115.903C230.344,117.072 230.805,118.118 230.805,119.041C230.805,122.486 227.775,126.608 221.715,131.407C215.655,136.206 210.441,138.605 206.073,138.605C197.336,138.605 192.968,133.007 192.968,121.81C192.968,117.687 193.491,111.012 194.537,101.784L199.059,60.994L179.587,60.994L190.384,50.289L200.259,50.289L202.197,33.493L215.763,28.971L213.456,50.289L252.584,50.289L241.787,60.994L212.256,60.994ZM253.154,136.206L253.154,2.834L282.908,2.834L282.908,136.206L253.154,136.206ZM282.908,84.934L282.908,59.336L342.605,58.374L342.605,83.972L282.908,84.934ZM282.908,28.431L282.908,2.834L345.627,2.834L345.627,28.431L282.908,28.431ZM398.428,138.284C390.079,138.284 382.655,136.552 376.156,133.089C369.657,129.626 364.566,124.829 360.882,118.699C357.198,112.569 355.356,105.534 355.356,97.594L355.356,44.394L384.26,44.394L384.26,97.29C384.26,100.448 384.823,103.168 385.948,105.45C387.074,107.732 388.711,109.493 390.858,110.732C393.006,111.972 395.539,112.592 398.458,112.592C402.783,112.592 406.205,111.236 408.724,108.524C411.243,105.813 412.502,102.068 412.502,97.29L412.502,44.394L441.406,44.394L441.406,97.573C441.406,105.634 439.58,112.718 435.927,118.826C432.275,124.934 427.224,129.704 420.773,133.136C414.322,136.568 406.874,138.284 398.428,138.284ZM487.784,138.567C482.368,138.567 477.047,137.859 471.821,136.442C466.594,135.025 461.761,133.042 457.322,130.491C452.882,127.941 449.088,124.934 445.94,121.471L462.281,104.847C465.366,108.184 468.987,110.75 473.143,112.545C477.299,114.339 481.833,115.237 486.745,115.237C490.145,115.237 492.743,114.749 494.538,113.773C496.332,112.797 497.23,111.395 497.23,109.569C497.23,107.302 496.143,105.571 493.971,104.374C491.798,103.178 489.012,102.123 485.611,101.21C482.211,100.297 478.622,99.258 474.843,98.093C471.065,96.928 467.46,95.338 464.028,93.323C460.596,91.308 457.81,88.521 455.669,84.963C453.528,81.406 452.457,76.824 452.457,71.22C452.457,65.364 453.969,60.247 456.991,55.871C460.014,51.494 464.296,48.063 469.837,45.575C475.379,43.088 481.896,41.844 489.39,41.844C497.135,41.844 504.33,43.182 510.973,45.859C517.616,48.535 523.016,52.549 527.172,57.902L510.737,74.526C507.84,71.126 504.597,68.717 501.008,67.3C497.418,65.883 493.892,65.175 490.429,65.175C487.154,65.175 484.714,65.663 483.108,66.639C481.503,67.615 480.7,68.953 480.7,70.653C480.7,72.605 481.77,74.148 483.911,75.282C486.052,76.415 488.823,77.423 492.223,78.304C495.624,79.186 499.197,80.241 502.944,81.469C506.691,82.697 510.265,84.397 513.665,86.569C517.065,88.742 519.836,91.623 521.977,95.212C524.118,98.801 525.189,103.461 525.189,109.192C525.189,118.196 521.82,125.344 515.082,130.633C508.344,135.923 499.245,138.567 487.784,138.567ZM533.217,136.206L533.217,44.394L562.121,44.394L562.121,136.206L533.217,136.206ZM547.669,31.737C543.198,31.737 539.483,30.21 536.523,27.156C533.564,24.102 532.084,20.34 532.084,15.869C532.084,11.398 533.564,7.635 536.523,4.581C539.483,1.527 543.198,0 547.669,0C552.266,0 556.013,1.527 558.91,4.581C561.806,7.635 563.255,11.398 563.255,15.869C563.255,20.34 561.806,24.102 558.91,27.156C556.013,30.21 552.266,31.737 547.669,31.737ZM619.322,138.285C609.809,138.285 601.256,136.175 593.665,131.954C586.073,127.733 580.073,121.968 575.663,114.66C571.253,107.352 569.048,99.162 569.048,90.09C569.048,81.018 571.237,72.891 575.615,65.709C579.994,58.527 585.979,52.826 593.57,48.605C601.162,44.384 609.714,42.273 619.227,42.273C628.803,42.273 637.371,44.368 644.931,48.557C652.491,52.747 658.476,58.448 662.886,65.662C667.296,72.875 669.501,81.018 669.501,90.09C669.501,99.162 667.312,107.352 662.933,114.66C658.555,121.968 652.586,127.733 645.026,131.954C637.466,136.175 628.898,138.285 619.322,138.285ZM619.227,112.014C623.385,112.014 627.039,111.101 630.189,109.274C633.339,107.447 635.78,104.879 637.513,101.572C639.245,98.264 640.112,94.469 640.112,90.185C640.112,85.901 639.214,82.136 637.418,78.892C635.623,75.647 633.182,73.112 630.095,71.285C627.008,69.458 623.385,68.544 619.227,68.544C615.195,68.544 611.604,69.473 608.454,71.332C605.304,73.19 602.847,75.742 601.083,78.986C599.319,82.231 598.437,85.995 598.437,90.279C598.437,94.5 599.319,98.264 601.083,101.572C602.847,104.879 605.304,107.447 608.454,109.274C611.604,111.101 615.195,112.014 619.227,112.014ZM744.062,136.206L744.062,83.948C744.062,79.097 742.581,75.206 739.62,72.277C736.659,69.347 732.887,67.883 728.304,67.883C725.185,67.883 722.417,68.544 720,69.867C717.582,71.19 715.696,73.064 714.341,75.49C712.987,77.915 712.31,80.735 712.31,83.948L712.31,51.604C712.31,51.604 716.541,48.27 719.009,46.951C724.609,43.958 730.957,42.462 738.052,42.462C744.767,42.462 750.755,44.069 756.016,47.282C761.276,50.495 765.419,54.747 768.443,60.039C771.467,65.331 772.979,71.127 772.979,77.427L772.979,136.206L744.062,136.206ZM683.393,136.206L683.393,44.352L712.31,44.352L712.31,136.206L683.393,136.206Z"
            ></path>
          </svg>
        </div>
      </div>

      <div className="h-[100vh] w-[100vw] fixed overflow-hidden flex items-center justify-center z-40">
        <Button
          color="black"
          size="sm"
          className="rounded-lg font-outfit normal-case w-fit py-3 px-6 pl-8 mt-24 ml-44 font-light flex items-center justify-center"
          onClick={() => router.push("/login")}
        >
          Launch
          <ChevronRight size={16} className="ml-2 -mr-2" />
        </Button>
      </div>
      <div
        className="h-[200vh] w-[200vw] relative z-20 opacity-0"
        ref={gallery}
      >
        {items.map((item, index) => (
          <FloatingItem key={index} item={item} />
        ))}
        <div className="w-full h-full top-0 left-0 absolute opacity-15">
          <svg
            id="grid"
            preserveAspectRatio="xMidYMid meet"
            viewBox="150 150 1000 550"
          >
            <GridPaths />
          </svg>
        </div>
      </div>
    </div>
  );
}
